{"ast":null,"code":"import _regeneratorRuntime from\"/Users/damnitstiff/Desktop/coding/twelve/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/damnitstiff/Desktop/coding/twelve/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/damnitstiff/Desktop/coding/twelve/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/damnitstiff/Desktop/coding/twelve/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from\"react\";import{loadStripe}from\"@stripe/stripe-js\";import{useLazyQuery}from\"@apollo/client\";import{QUERY_CHECKOUT}from\"../../utils/queries\";import{idbPromise}from\"../../utils/helpers\";import CartItem from\"../CartItem\";import Auth from\"../../utils/auth\";import{useDispatch,useSelector}from\"react-redux\";import{TOGGLE_CART,ADD_MULTIPLE_TO_CART}from\"../../utils/actions\";import{Link}from\"react-router-dom\";import\"./style.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var stripePromise=loadStripe(\"pk_test_TYooMQauvdEDq54NiTphI7jx\");var Cart=function Cart(){var dispatch=useDispatch();var state=useSelector(function(state){return state;});var _useLazyQuery=useLazyQuery(QUERY_CHECKOUT),_useLazyQuery2=_slicedToArray(_useLazyQuery,2),getCheckout=_useLazyQuery2[0],data=_useLazyQuery2[1].data;useEffect(function(){if(data){stripePromise.then(function(res){res.redirectToCheckout({sessionId:data.checkout.session});});}},[data]);useEffect(function(){function getCart(){return _getCart.apply(this,arguments);}function _getCart(){_getCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var cart;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return idbPromise(\"cart\",\"get\");case 2:cart=_context.sent;dispatch({type:ADD_MULTIPLE_TO_CART,products:_toConsumableArray(cart)});case 4:case\"end\":return _context.stop();}},_callee);}));return _getCart.apply(this,arguments);}if(!state.cart.length){getCart();}},[state.cart.length,dispatch]);function toggleCart(){dispatch({type:TOGGLE_CART});}function calculateTotal(){var sum=0;state.cart.forEach(function(item){sum+=item.price*item.purchaseQuantity;});return sum.toFixed(2);}function calculateCartCount(){var count=0;state.cart.forEach(function(item){count+=item.purchaseQuantity;});return count;};function submitCheckout(){var productIds=[];state.cart.forEach(function(item){for(var i=0;i<item.purchaseQuantity;i++){productIds.push(item._id);}});getCheckout({variables:{products:productIds}});}if(!state.cartOpen){return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-closed\",onClick:toggleCart,children:[calculateCartCount()>0&&/*#__PURE__*/ // Check if there are items in the cart\n_jsx(\"span\",{className:\"cart-count\",children:calculateCartCount()}),\" \",/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"trash\",children:\"\\uD83D\\uDED2\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"cart\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"close\",onClick:toggleCart,children:\"\\u274E\"}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Total Items: \",/*#__PURE__*/_jsx(\"span\",{className:\"cart-count\",children:calculateCartCount()})]}),state.cart.length?/*#__PURE__*/_jsxs(\"div\",{children:[state.cart.map(function(item){return/*#__PURE__*/_jsx(CartItem,{item:item},item._id);}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-row space-between\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Total: $\",calculateTotal()]}),Auth.loggedIn()?/*#__PURE__*/_jsx(\"button\",{onClick:submitCheckout,children:\"Checkout\"}):/*#__PURE__*/ // <span>(log in to check out)</span>\n_jsx(Link,{to:\"/login\",children:\"Login To Checkout\"})]})]}):/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"shocked\",children:\"\\uD83E\\uDD16\"}),\"You haven't added anything to your cart yet!\"]})]});};export default Cart;","map":{"version":3,"names":["React","useEffect","loadStripe","useLazyQuery","QUERY_CHECKOUT","idbPromise","CartItem","Auth","useDispatch","useSelector","TOGGLE_CART","ADD_MULTIPLE_TO_CART","Link","jsx","_jsx","jsxs","_jsxs","stripePromise","Cart","dispatch","state","_useLazyQuery","_useLazyQuery2","_slicedToArray","getCheckout","data","then","res","redirectToCheckout","sessionId","checkout","session","getCart","_getCart","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","cart","wrap","_callee$","_context","prev","next","sent","type","products","_toConsumableArray","stop","length","toggleCart","calculateTotal","sum","forEach","item","price","purchaseQuantity","toFixed","calculateCartCount","count","submitCheckout","productIds","i","push","_id","variables","cartOpen","className","onClick","children","role","map","loggedIn","to"],"sources":["/Users/damnitstiff/Desktop/coding/twelve/client/src/components/Cart/index.js"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { useLazyQuery } from \"@apollo/client\";\nimport { QUERY_CHECKOUT } from \"../../utils/queries\";\nimport { idbPromise } from \"../../utils/helpers\";\nimport CartItem from \"../CartItem\";\nimport Auth from \"../../utils/auth\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { TOGGLE_CART, ADD_MULTIPLE_TO_CART } from \"../../utils/actions\";\nimport { Link } from \"react-router-dom\";\nimport \"./style.css\";\n\nconst stripePromise = loadStripe(\"pk_test_TYooMQauvdEDq54NiTphI7jx\");\n\nconst Cart = () => {\n  const dispatch = useDispatch();\n  const state = useSelector((state) => state);\n  const [getCheckout, { data }] = useLazyQuery(QUERY_CHECKOUT);\n\n  useEffect(() => {\n    if (data) {\n      stripePromise.then((res) => {\n        res.redirectToCheckout({ sessionId: data.checkout.session });\n      });\n    }\n  }, [data]);\n\n  useEffect(() => {\n    async function getCart() {\n      const cart = await idbPromise(\"cart\", \"get\");\n      dispatch({ type: ADD_MULTIPLE_TO_CART, products: [...cart] });\n    }\n\n    if (!state.cart.length) {\n      getCart();\n    }\n  }, [state.cart.length, dispatch]);\n\n  function toggleCart() {\n    dispatch({ type: TOGGLE_CART });\n  }\n\n  function calculateTotal() {\n    let sum = 0;\n    state.cart.forEach((item) => {\n      sum += item.price * item.purchaseQuantity;\n    });\n    return sum.toFixed(2);\n  }\n\n  function calculateCartCount() {\n    let count = 0;\n    state.cart.forEach((item) => {\n      count += item.purchaseQuantity;\n    });\n    return count;\n  };\n\n  function submitCheckout() {\n    const productIds = [];\n\n    state.cart.forEach((item) => {\n      for (let i = 0; i < item.purchaseQuantity; i++) {\n        productIds.push(item._id);\n      }\n    });\n\n    getCheckout({\n      variables: { products: productIds },\n    });\n  }\n\n  if (!state.cartOpen) {\n    return (\n      <div className=\"cart-closed\" onClick={toggleCart}>\n        {calculateCartCount() > 0 && ( // Check if there are items in the cart\n          <span className=\"cart-count\">{calculateCartCount()}</span>\n        )}{\" \"} \n        <span role=\"img\" aria-label=\"trash\">\n          üõí\n        </span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"cart\">\n      <div className=\"close\" onClick={toggleCart}>\n      ‚ùé\n      </div>\n      <h2>Total Items: <span className=\"cart-count\">{calculateCartCount()}</span></h2>\n      {state.cart.length ? (\n        <div>\n          {state.cart.map((item) => (\n            <CartItem key={item._id} item={item} />\n          ))}\n\n          <div className=\"flex-row space-between\">\n            <strong>Total: ${calculateTotal()}</strong>\n\n            {Auth.loggedIn() ? (\n              <button onClick={submitCheckout}>Checkout</button>\n            ) : (\n              // <span>(log in to check out)</span>\n              <Link to=\"/login\">Login To Checkout</Link>\n            )}\n          </div>\n        </div>\n      ) : (\n        <h3>\n          <span role=\"img\" aria-label=\"shocked\">\n          ü§ñ\n          </span>\n          You haven't added anything to your cart yet!\n        </h3>\n      )}\n    </div>\n  );\n};\n\nexport default Cart;\n"],"mappings":"4iBAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,UAAU,KAAQ,mBAAmB,CAC9C,OAASC,YAAY,KAAQ,gBAAgB,CAC7C,OAASC,cAAc,KAAQ,qBAAqB,CACpD,OAASC,UAAU,KAAQ,qBAAqB,CAChD,MAAO,CAAAC,QAAQ,KAAM,aAAa,CAClC,MAAO,CAAAC,IAAI,KAAM,kBAAkB,CACnC,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,WAAW,CAAEC,oBAAoB,KAAQ,qBAAqB,CACvE,OAASC,IAAI,KAAQ,kBAAkB,CACvC,MAAO,aAAa,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAErB,GAAM,CAAAC,aAAa,CAAGf,UAAU,CAAC,kCAAkC,CAAC,CAEpE,GAAM,CAAAgB,IAAI,CAAG,QAAP,CAAAA,IAAIA,CAAA,CAAS,CACjB,GAAM,CAAAC,QAAQ,CAAGX,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAAY,KAAK,CAAGX,WAAW,CAAC,SAACW,KAAK,QAAK,CAAAA,KAAK,GAAC,CAC3C,IAAAC,aAAA,CAAgClB,YAAY,CAACC,cAAc,CAAC,CAAAkB,cAAA,CAAAC,cAAA,CAAAF,aAAA,IAArDG,WAAW,CAAAF,cAAA,IAAIG,IAAI,CAAAH,cAAA,IAAJG,IAAI,CAE1BxB,SAAS,CAAC,UAAM,CACd,GAAIwB,IAAI,CAAE,CACRR,aAAa,CAACS,IAAI,CAAC,SAACC,GAAG,CAAK,CAC1BA,GAAG,CAACC,kBAAkB,CAAC,CAAEC,SAAS,CAAEJ,IAAI,CAACK,QAAQ,CAACC,OAAQ,CAAC,CAAC,CAC9D,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,CAACN,IAAI,CAAC,CAAC,CAEVxB,SAAS,CAAC,UAAM,SACC,CAAA+B,OAAOA,CAAA,SAAAC,QAAA,CAAAC,KAAA,MAAAC,SAAA,YAAAF,SAAA,EAAAA,QAAA,CAAAG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAtB,SAAAC,QAAA,MAAAC,IAAA,QAAAH,mBAAA,GAAAI,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAAF,QAAA,CAAAE,IAAA,SACqB,CAAAxC,UAAU,CAAC,MAAM,CAAE,KAAK,CAAC,QAAtCmC,IAAI,CAAAG,QAAA,CAAAG,IAAA,CACV3B,QAAQ,CAAC,CAAE4B,IAAI,CAAEpC,oBAAoB,CAAEqC,QAAQ,CAAAC,kBAAA,CAAMT,IAAI,CAAE,CAAC,CAAC,CAAC,wBAAAG,QAAA,CAAAO,IAAA,MAAAX,OAAA,GAC/D,UAAAN,QAAA,CAAAC,KAAA,MAAAC,SAAA,GAED,GAAI,CAACf,KAAK,CAACoB,IAAI,CAACW,MAAM,CAAE,CACtBnB,OAAO,CAAC,CAAC,CACX,CACF,CAAC,CAAE,CAACZ,KAAK,CAACoB,IAAI,CAACW,MAAM,CAAEhC,QAAQ,CAAC,CAAC,CAEjC,QAAS,CAAAiC,UAAUA,CAAA,CAAG,CACpBjC,QAAQ,CAAC,CAAE4B,IAAI,CAAErC,WAAY,CAAC,CAAC,CACjC,CAEA,QAAS,CAAA2C,cAAcA,CAAA,CAAG,CACxB,GAAI,CAAAC,GAAG,CAAG,CAAC,CACXlC,KAAK,CAACoB,IAAI,CAACe,OAAO,CAAC,SAACC,IAAI,CAAK,CAC3BF,GAAG,EAAIE,IAAI,CAACC,KAAK,CAAGD,IAAI,CAACE,gBAAgB,CAC3C,CAAC,CAAC,CACF,MAAO,CAAAJ,GAAG,CAACK,OAAO,CAAC,CAAC,CAAC,CACvB,CAEA,QAAS,CAAAC,kBAAkBA,CAAA,CAAG,CAC5B,GAAI,CAAAC,KAAK,CAAG,CAAC,CACbzC,KAAK,CAACoB,IAAI,CAACe,OAAO,CAAC,SAACC,IAAI,CAAK,CAC3BK,KAAK,EAAIL,IAAI,CAACE,gBAAgB,CAChC,CAAC,CAAC,CACF,MAAO,CAAAG,KAAK,CACd,CAAC,CAED,QAAS,CAAAC,cAAcA,CAAA,CAAG,CACxB,GAAM,CAAAC,UAAU,CAAG,EAAE,CAErB3C,KAAK,CAACoB,IAAI,CAACe,OAAO,CAAC,SAACC,IAAI,CAAK,CAC3B,IAAK,GAAI,CAAAQ,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGR,IAAI,CAACE,gBAAgB,CAAEM,CAAC,EAAE,CAAE,CAC9CD,UAAU,CAACE,IAAI,CAACT,IAAI,CAACU,GAAG,CAAC,CAC3B,CACF,CAAC,CAAC,CAEF1C,WAAW,CAAC,CACV2C,SAAS,CAAE,CAAEnB,QAAQ,CAAEe,UAAW,CACpC,CAAC,CAAC,CACJ,CAEA,GAAI,CAAC3C,KAAK,CAACgD,QAAQ,CAAE,CACnB,mBACEpD,KAAA,QAAKqD,SAAS,CAAC,aAAa,CAACC,OAAO,CAAElB,UAAW,CAAAmB,QAAA,EAC9CX,kBAAkB,CAAC,CAAC,CAAG,CAAC,gBAAM;AAC7B9C,IAAA,SAAMuD,SAAS,CAAC,YAAY,CAAAE,QAAA,CAAEX,kBAAkB,CAAC,CAAC,CAAO,CAC1D,CAAE,GAAG,cACN9C,IAAA,SAAM0D,IAAI,CAAC,KAAK,CAAC,aAAW,OAAO,CAAAD,QAAA,CAAC,cAEpC,CAAM,CAAC,EACJ,CAAC,CAEV,CAEA,mBACEvD,KAAA,QAAKqD,SAAS,CAAC,MAAM,CAAAE,QAAA,eACnBzD,IAAA,QAAKuD,SAAS,CAAC,OAAO,CAACC,OAAO,CAAElB,UAAW,CAAAmB,QAAA,CAAC,QAE5C,CAAK,CAAC,cACNvD,KAAA,OAAAuD,QAAA,EAAI,eAAa,cAAAzD,IAAA,SAAMuD,SAAS,CAAC,YAAY,CAAAE,QAAA,CAAEX,kBAAkB,CAAC,CAAC,CAAO,CAAC,EAAI,CAAC,CAC/ExC,KAAK,CAACoB,IAAI,CAACW,MAAM,cAChBnC,KAAA,QAAAuD,QAAA,EACGnD,KAAK,CAACoB,IAAI,CAACiC,GAAG,CAAC,SAACjB,IAAI,qBACnB1C,IAAA,CAACR,QAAQ,EAAgBkD,IAAI,CAAEA,IAAK,EAArBA,IAAI,CAACU,GAAkB,CAAC,EACxC,CAAC,cAEFlD,KAAA,QAAKqD,SAAS,CAAC,wBAAwB,CAAAE,QAAA,eACrCvD,KAAA,WAAAuD,QAAA,EAAQ,UAAQ,CAAClB,cAAc,CAAC,CAAC,EAAS,CAAC,CAE1C9C,IAAI,CAACmE,QAAQ,CAAC,CAAC,cACd5D,IAAA,WAAQwD,OAAO,CAAER,cAAe,CAAAS,QAAA,CAAC,UAAQ,CAAQ,CAAC,eAElD;AACAzD,IAAA,CAACF,IAAI,EAAC+D,EAAE,CAAC,QAAQ,CAAAJ,QAAA,CAAC,mBAAiB,CAAM,CAC1C,EACE,CAAC,EACH,CAAC,cAENvD,KAAA,OAAAuD,QAAA,eACEzD,IAAA,SAAM0D,IAAI,CAAC,KAAK,CAAC,aAAW,SAAS,CAAAD,QAAA,CAAC,cAEtC,CAAM,CAAC,+CAET,EAAI,CACL,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAArD,IAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}